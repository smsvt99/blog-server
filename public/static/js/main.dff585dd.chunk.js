(this["webpackJsonpyuli-blog-client"]=this["webpackJsonpyuli-blog-client"]||[]).push([[0],{25:function(e,t,n){},33:function(e,t,n){"use strict";n.r(t);var c=n(1),s=n.n(c),a=n(17),r=n.n(a),i=(n(25),n(2)),j=n(10),l=n(4),o=n(3),u=n.n(o),d=n(5),b=n(18),h=function e(t,n){var c=this;return Object(b.a)(this,e),this.queryParams=[],this.options={credentials:"include"},this.setQueryParams=function(e){var t=Object(i.a)(e,2),n=t[0],s=t[1];return c.queryParams.push([n,s]),c},this.setBody=function(e){return c.options.body=JSON.stringify(e),c},this.setAdditionalOptions=function(e){},this.call=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return["POST","PATCH"].includes(c.options.method)&&(c.options.headers={"Content-Type":"application/json"}),c.applyQueryParams(),e.next=4,fetch(c.endPoint,c.options);case 4:return t=e.sent,e.next=7,t.json();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)}))),this.applyQueryParams=function(){c.queryParams.forEach((function(e,t){var n=Object(i.a)(e,2),s=n[0],a=n[1],r=0===t?"?":"&";c.endPoint+=r+s+"="+a}))},this.options.method=t,this.endPoint=n,this},p=n(0);function O(e){var t=e.additionalClasses,n=e.onClick,c=e.children;return t||(t=""),Object(p.jsx)("button",{className:"A ".concat(t),onClick:n,children:c})}var x=Object(l.j)((function(e){var t=e.me,n=e.setMe,s=Object(c.useState)(!1),a=Object(i.a)(s,2),r=a[0],o=a[1],b=Object(l.h)().pathname.includes("admin");function x(){return(x=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new h("GET","/logout").call();case 2:t=e.sent,n(t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return(g=Object(d.a)(u.a.mark((function e(c){var s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=7;break}return e.next=3,new h("GET","/me").call();case 3:s=e.sent,t.isLogged?n(s):o(!r),e.next=8;break;case 7:o(!r);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var v=[];t.isLoggedIn?(v.push(t.name),!b&&"ADMIN"===t.role&&v.push(Object(p.jsx)(j.b,{to:"/admin/new_post",children:Object(p.jsx)(O,{children:"Dashboard"})})),b&&v.push(Object(p.jsx)(j.b,{to:"/",children:Object(p.jsx)(O,{children:"Main Site"})})),v.push(Object(p.jsx)(O,{onClick:function(){return x.apply(this,arguments)},children:"Logout"}))):v.push(Object(p.jsx)(O,{onClick:f,children:"Login"}));var w=v.map((function(e,t){var n=0===t?"":" | ";return Object(p.jsxs)("span",{children:[n,e]},"menu_".concat(t))}));return Object(p.jsxs)("div",{id:"top-nav",children:[Object(p.jsx)("div",{children:w}),r?Object(p.jsx)(m,{me:t,setMe:n,toggle:f,setShowForm:o}):null]})}));function m(e){e.me;var t=e.setMe,n=e.toggle,s=e.setShowForm,a=Object(c.useState)(""),r=Object(i.a)(a,2),o=r[0],b=r[1],x=Object(c.useState)(""),m=Object(i.a)(x,2),f=m[0],g=m[1],v=Object(c.useState)(!1),w=Object(i.a)(v,2),y=w[0],N=w[1],k=Object(l.g)();function S(){return(S=Object(d.a)(u.a.mark((function e(){var c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new h("POST","/login").setBody({username:o,password:f}).call();case 2:(c=e.sent).isLoggedIn?(n(),t(c),k.push("/admin/new_post")):N(!0);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(p.jsxs)("div",{id:"login",children:[Object(p.jsx)("div",{className:"right",children:Object(p.jsx)(O,{onClick:n,children:"\u2716"})}),Object(p.jsx)("h2",{className:"center space",children:"Login"}),y&&Object(p.jsx)("p",{className:"red center",children:"Invalid credentials"}),Object(p.jsxs)("div",{className:"form-group",children:[Object(p.jsx)("label",{children:"Email:"}),Object(p.jsx)("input",{value:o,onChange:function(e){b(e.target.value)}})]}),Object(p.jsxs)("div",{className:"form-group",children:[Object(p.jsx)("label",{children:"Password:"}),Object(p.jsx)("input",{type:"password",value:f,onChange:function(e){g(e.target.value)}})]}),Object(p.jsx)("div",{className:"form-group",children:Object(p.jsx)("button",{className:"button",onClick:function(){return S.apply(this,arguments)},children:"Submit"})}),Object(p.jsx)("p",{className:"detail right",children:Object(p.jsx)(j.b,{onClick:function(){return s(!1)},to:"/sign-up",children:Object(p.jsx)(O,{children:"Sign Up"})})})]})}function f(e){return e.split("T")[0]}function g(e){var t=e.post,n=e.stub,c=e.me,s=t.user,a=t.createdAt!==t.updatedAt;return Object(p.jsxs)("div",{className:"post",children:[n?Object(p.jsx)("h2",{children:t.title}):Object(p.jsx)("h1",{children:t.title}),Object(p.jsxs)("p",{children:["By ",s.name]}),Object(p.jsxs)("p",{className:"detail",children:["Published ",f(t.createdAt)]}),a?Object(p.jsxs)("p",{className:"detail",children:["Edited ",f(t.updatedAt)]}):null,n?null:Object(p.jsxs)("div",{children:[Object(p.jsx)(N,{tags:t.tags}),Object(p.jsx)("hr",{}),Object(p.jsx)("p",{children:t.body}),Object(p.jsx)("hr",{}),Object(p.jsx)(v,{me:c,postId:t._id})]})]})}function v(e){var t=Object(c.useState)([]),n=Object(i.a)(t,2),s=n[0],a=n[1],r=Object(c.useState)(!1),j=Object(i.a)(r,2),l=j[0],o=j[1];function b(){return x.apply(this,arguments)}function x(){return(x=Object(d.a)(u.a.mark((function t(){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new h("GET","/comments").setQueryParams(["post_id",e.postId]).call();case 2:n=t.sent,a(n);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(c.useEffect)((function(){l&&b()}),[l]),l?Object(p.jsxs)("div",{children:[e.me.isLoggedIn?Object(p.jsx)(y,{postId:e.postId,getComments:b}):Object(p.jsx)("p",{className:"detail",children:"Log in to leave a comment"}),s.length?Object(p.jsxs)("div",{children:[" ",s.map((function(t){return Object(p.jsx)(w,{comment:t,me:e.me})}))]}):Object(p.jsx)("p",{className:"detail",children:"No comments yet"}),Object(p.jsx)("div",{className:"right",children:Object(p.jsx)(O,{onClick:function(e){o(!1)},children:"Hide Comments"})})]}):Object(p.jsx)("div",{className:"right",children:Object(p.jsx)(O,{onClick:function(e){o(!0)},children:"Load Comments"})})}function w(e){var t=e.comment,n=t.user,c=t.createdAt!==t.updatedAt;return Object(p.jsxs)("div",{className:"comment",children:[Object(p.jsxs)("div",{className:"flex-row align-base",children:[Object(p.jsx)("p",{children:n.name}),Object(p.jsx)("p",{className:"detail",children:f(t.createdAt)})]}),c?Object(p.jsxs)("p",{className:"detail",children:["Edited ",f(t.updatedAt)]}):null,Object(p.jsx)("p",{children:t.body})]})}function y(e){var t=Object(c.useState)(""),n=Object(i.a)(t,2),s=n[0],a=n[1],r=Object(c.useState)(!1),j=Object(i.a)(r,2),l=j[0],o=j[1];function b(){return(b=Object(d.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new h("POST","/comments").setBody({body:s,postId:e.postId}).call();case 2:t.sent.success?(a(""),o(!1),e.getComments()):o(!0);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(p.jsxs)("div",{className:"form-group",children:[Object(p.jsx)("label",{children:"New Comment"}),l&&Object(p.jsx)("p",{className:"red center",children:"Unable to save comment"}),Object(p.jsx)("textarea",{rows:"5",value:s,onChange:function(e){a(e.target.value)}}),Object(p.jsx)("div",{className:"right",children:Object(p.jsx)("button",{onClick:function(){return b.apply(this,arguments)},children:"Submit"})})]})}function N(e){var t=e.tags;return Object(p.jsx)("div",{className:"flex-row",children:t.map((function(e){return Object(p.jsx)(k,{tag:e},e._id)}))})}function k(e){var t=e.tag;return Object(p.jsx)("p",{className:"tag",children:t.name})}function S(e){var t=e.appState,n=t.posts,s=t.setPosts,a=t.me;return Object(c.useEffect)((function(){!function(){var e=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new h("GET","/posts").call();case 2:t=e.sent,s(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[s]),n?n.map((function(e){return Object(p.jsx)(g,{post:e,stub:!1,me:a},e._id)})):"loading...."}function C(e){var t=e._id,n=Object(c.useState)(""),s=Object(i.a)(n,2),a=s[0],r=s[1],j=Object(c.useState)(""),o=Object(i.a)(j,2),b=o[0],x=o[1],m=Object(c.useState)([]),f=Object(i.a)(m,2),g=f[0],v=f[1],w=Object(c.useState)(!1),y=Object(i.a)(w,2),N=y[0],k=y[1],S=Object(c.useState)([]),C=Object(i.a)(S,2),E=C[0],_=C[1],A=Object(c.useState)(!1),I=Object(i.a)(A,2),L=I[0],B=I[1],M=Object(c.useState)(!1),G=Object(i.a)(M,2),Q=G[0],U=G[1],D=e._id?"Editing":"New Post",F=Q?"":" Add/ Pick",J=Object(l.g)();function q(){U(!Q)}function H(){return(H=Object(d.a)(u.a.mark((function e(){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={title:a,body:b,tags:g,published:N},!t){e.next=8;break}return e.next=4,new h("PATCH","/posts").setQueryParams(["_id",t]).setBody(n).call();case 4:e.sent.success?J.push("/"):alert("Unable to save"),e.next=12;break;case 8:return e.next=10,new h("POST","/posts").setBody(n).call();case 10:e.sent.success?J.push("/"):alert("Unable to save");case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(c.useEffect)((function(){L||function(){var e=Object(d.a)(u.a.mark((function e(){var n,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new h("GET","/tags").call();case 2:if(n=e.sent,!t){e.next=11;break}return e.next=6,new h("GET","/posts").setQueryParams(["_id",t]).call();case 6:c=e.sent,r(c.title),x(c.body),v(c.tags),k(c.published);case 11:_(n),B(!0);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[]),L?Object(p.jsxs)("div",{id:"post-edit",children:[Object(p.jsx)("div",{className:"window-topper"}),Object(p.jsxs)("div",{className:"window-body",children:[Object(p.jsx)("h2",{className:"center",children:D}),Object(p.jsxs)("div",{children:[Object(p.jsxs)("div",{className:"form-group",children:[Object(p.jsx)("label",{children:"Title"}),Object(p.jsx)("input",{onChange:function(e){r(e.target.value)},value:a,type:"text"})]}),Object(p.jsxs)("div",{className:"form-group",children:[Object(p.jsxs)("div",{className:"flex-row",children:[Object(p.jsx)("label",{className:"pad-right",children:"Tags"}),Object(p.jsx)(O,{onClick:q,children:F})]}),Q&&Object(p.jsxs)("div",{id:"tag-select",children:[Object(p.jsx)("div",{className:"right",children:Object(p.jsx)(O,{onClick:q,children:"\u2716"})}),Object(p.jsx)(T,{setAllTags:_}),E.map((function(e){return Object(p.jsx)(P,{tag:e,tags:g,setTags:v,allTags:E},e._id)}))]})]}),Object(p.jsxs)("div",{className:"form-group",children:[Object(p.jsx)("label",{children:"Body"}),Object(p.jsx)("textarea",{rows:"25",onChange:function(e){x(e.target.value)},value:b})]}),Object(p.jsx)("div",{className:"form-group",children:Object(p.jsxs)("label",{children:["Published",Object(p.jsx)("input",{checked:N,onChange:function(){k(!N)},className:"space-right",type:"checkbox"})]})}),Object(p.jsx)("div",{className:"form-group",children:Object(p.jsx)("button",{onClick:function(){return H.apply(this,arguments)},className:"button",children:"Save"})})]})]})]}):Object(p.jsx)("div",{style:{width:"500px"},children:"Loading...."})}function P(e){var t=e.tag,n=e.tags,c=e.setTags,s=(e.allTags,n.map((function(e){return e._id})).includes(t._id));function a(){if(s){var e=n.filter((function(e){return e._id!==t._id}));c(e)}else{var a=JSON.parse(JSON.stringify(n));a.push(t),c(a)}}return Object(p.jsx)("div",{children:Object(p.jsxs)("div",{className:"flex-row tag-option",onClick:a,children:[Object(p.jsx)("input",{onChange:a,checked:s,type:"checkbox"}),Object(p.jsx)("label",{children:t.name})]})})}function T(e){var t=Object(c.useState)(""),n=Object(i.a)(t,2),s=n[0],a=n[1];function r(){return(r=Object(d.a)(u.a.mark((function t(){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new h("POST","/tags").setBody({name:s}).call();case 2:if(!t.sent.success){t.next=10;break}return t.next=6,new h("GET","/tags").call();case 6:n=t.sent,e.setAllTags(n),t.next=11;break;case 10:alert("Unable to save tag");case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(p.jsxs)("div",{children:[Object(p.jsx)("p",{children:"Add New Tag"}),Object(p.jsx)("input",{onChange:function(e){a(e.target.value)},value:s,type:"text"}),Object(p.jsx)("button",{onClick:function(){return r.apply(this,arguments)},children:"Enter"}),Object(p.jsx)("hr",{})]})}function E(e){var t=e.post,n=e.setPostToEdit,c=e.setPosts;function s(){return(s=Object(d.a)(u.a.mark((function e(){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==window.confirm("Are you sure you want to delete '".concat(t.title,"'?"))){e.next=13;break}return e.next=4,new h("DELETE","/posts").setQueryParams(["_id",t._id]).call();case 4:if(!e.sent.success){e.next=12;break}return e.next=8,new h("GET","/posts").setQueryParams(["stub",1]).call();case 8:n=e.sent,c(n),e.next=13;break;case 12:alert("Unable to delete");case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(p.jsxs)("div",{className:"flex- stub",children:[Object(p.jsxs)("div",{className:"left",children:[Object(p.jsx)(O,{onClick:function(){n(t._id)},children:"Edit"}),Object(p.jsx)(O,{additionalClasses:"red",onClick:function(){return s.apply(this,arguments)},children:"Delete"})]}),Object(p.jsx)("div",{className:"right",children:Object(p.jsx)(g,{stub:"true",post:t},t._id)})]})}var _=function(){var e=Object(c.useState)(null),t=Object(i.a)(e,2),n=t[0],s=t[1],a=Object(c.useState)([]),r=Object(i.a)(a,2),j=r[0],l=r[1];return Object(c.useEffect)((function(){!function(){var e=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new h("GET","/posts").setQueryParams(["stub",1]).call();case 2:t=e.sent,l(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[]),n?Object(p.jsxs)("div",{children:[Object(p.jsx)("div",{className:"right space",children:Object(p.jsx)(O,{onClick:function(){s(null)},children:"Back to list"})}),Object(p.jsx)(C,{_id:n})]}):Object(p.jsx)("div",{children:j.map((function(e){return Object(p.jsx)(E,{post:e,setPostToEdit:s,setPosts:l},e._id)}))})};var A=Object(l.j)((function(){var e="new_post",t="manage_posts",n="manage_tags",c="manage_users",s="manage_comments",a=Object(l.i)();return Object(p.jsxs)("div",{id:"admin",children:[Object(p.jsx)("h1",{children:"Admin Dashboard"}),Object(p.jsx)("hr",{}),Object(p.jsxs)("div",{id:"wrapper",children:[Object(p.jsxs)("ul",{children:[Object(p.jsx)(I,{option:e,current:a.params.option,children:Object(p.jsx)(O,{children:"Write New Post"})}),Object(p.jsx)(I,{option:t,current:a.params.option,children:Object(p.jsx)(O,{children:"Manage Posts"})}),Object(p.jsx)(I,{option:n,current:a.params.option,children:Object(p.jsx)(O,{children:"Manage Tags"})}),Object(p.jsx)(I,{option:c,current:a.params.option,children:Object(p.jsx)(O,{children:"Manage Users"})}),Object(p.jsx)(I,{option:s,current:a.params.option,children:Object(p.jsx)(O,{children:"Manage Comments"})})]}),Object(p.jsx)("div",{id:"right",children:Object(p.jsxs)(l.d,{children:[Object(p.jsx)(l.b,{path:"".concat(a.path,"/").concat(e),children:Object(p.jsx)(C,{_id:null})}),Object(p.jsx)(l.b,{path:"".concat(a.path,"/").concat(t),children:Object(p.jsx)(_,{})}),Object(p.jsx)(l.b,{path:"".concat(a.path,"/").concat(n),children:Object(p.jsx)("p",{children:"manage tags"})}),Object(p.jsx)(l.b,{path:"".concat(a.path,"/").concat(c),children:Object(p.jsx)("p",{children:"manage users"})}),Object(p.jsx)(l.b,{path:"".concat(a.path,"/").concat(s),children:Object(p.jsx)("p",{children:"manage comments"})}),Object(p.jsx)(l.b,{children:Object(p.jsx)(l.a,{to:"".concat(a.path,"/").concat(e)})})]})})]})]})}));function I(e){var t=e.option===e.current?"menu-item current":"menu-item";return Object(p.jsx)(j.b,{to:"/admin/".concat(e.option),children:Object(p.jsx)("li",{className:t,children:e.children})})}function L(e){var t=Object(c.useState)(""),n=Object(i.a)(t,2),s=n[0],a=n[1],r=Object(c.useState)(""),j=Object(i.a)(r,2),l=j[0],o=j[1],b=Object(c.useState)(""),O=Object(i.a)(b,2),x=O[0],m=O[1],f=Object(c.useState)(""),g=Object(i.a)(f,2),v=g[0],w=g[1],y=Object(c.useState)(!1),N=Object(i.a)(y,2),k=N[0],S=N[1],C=Object(c.useState)(!1),P=Object(i.a)(C,2),T=P[0],E=P[1],_=Object(c.useState)([]),A=Object(i.a)(_,2),I=A[0],L=A[1];function B(){return 0===s.length||0===l.length||0===x.length||0===v.length?(L("All fields are required"),!1):l===x||(L("Passwords must match"),!1)}function M(){return(M=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(B()){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,new h("POST","/users").setBody({email:v,password:l,name:s,notify:k}).call();case 4:(t=e.sent).success?(E(!0),L(["Success! You can now log in with the credentials you provided."])):(E(!1),L(t.error.message));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(p.jsxs)("div",{id:"sign-up",children:[Object(p.jsx)("h1",{children:"Sign Up"}),Object(p.jsxs)("div",{children:[Object(p.jsxs)("div",{className:"form-group",children:[Object(p.jsx)("label",{children:"Display Name"}),Object(p.jsx)("input",{type:"text",value:s,onChange:function(e){a(e.target.value)},readOnly:T})]}),Object(p.jsxs)("div",{className:"form-group",children:[Object(p.jsx)("label",{children:"Email"}),Object(p.jsx)("input",{type:"text",value:v,onChange:function(e){w(e.target.value)},readOnly:T})]}),Object(p.jsxs)("div",{className:"form-group",children:[Object(p.jsx)("label",{children:"Password"}),Object(p.jsx)("input",{type:"password",value:l,onChange:function(e){o(e.target.value)},readOnly:T})]}),Object(p.jsxs)("div",{className:"form-group",children:[Object(p.jsx)("label",{children:"Password (confirm)"}),Object(p.jsx)("input",{type:"password",value:x,onChange:function(e){m(e.target.value)},readOnly:T})]}),Object(p.jsxs)("div",{className:"form-group",children:[Object(p.jsx)("label",{children:"Notify?"}),Object(p.jsxs)("p",{className:"detail",children:[Object(p.jsx)("input",{type:"checkbox",value:k,onChange:function(){S(!k)},readOnly:T}),"Email me when new posts are published"]})]}),Object(p.jsx)("div",{className:T?"center green":"center red",children:I}),Object(p.jsx)("div",{className:"form-group",children:Object(p.jsx)("button",{onClick:function(){return M.apply(this,arguments)},className:"button",disabled:T,children:"Sign Up"})})]})]})}function B(){var e=Object(c.useState)({isLoggedIn:!1}),t=Object(i.a)(e,2),n=t[0],s=t[1],a=Object(c.useState)(null),r=Object(i.a)(a,2),o=r[0],u=r[1],d={me:n,posts:o,setPosts:u};return Object(p.jsx)("div",{className:"app",children:Object(p.jsxs)(j.a,{children:[Object(p.jsx)(x,{me:n,setMe:s}),Object(p.jsxs)(l.d,{children:[Object(p.jsx)(l.b,{path:"/admin/:option?",render:function(){return n.isLoggedIn&&"ADMIN"===n.role?Object(p.jsx)(A,{}):Object(p.jsx)(l.a,{to:"/"})}}),Object(p.jsx)(l.b,{path:"/sign-up",children:Object(p.jsx)(L,{})}),Object(p.jsx)(l.b,{path:"/",children:Object(p.jsx)(S,{appState:d})}),Object(p.jsx)(l.b,{children:Object(p.jsx)(l.a,{to:"/"})})]})]})})}var M=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,34)).then((function(t){var n=t.getCLS,c=t.getFID,s=t.getFCP,a=t.getLCP,r=t.getTTFB;n(e),c(e),s(e),a(e),r(e)}))};r.a.render(Object(p.jsx)(s.a.StrictMode,{children:Object(p.jsx)(B,{})}),document.getElementById("root")),M()}},[[33,1,2]]]);
//# sourceMappingURL=main.dff585dd.chunk.js.map